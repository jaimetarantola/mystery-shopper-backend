<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Build Your Custom Shop Template</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #eaf2fb;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 800px;
      margin: 80px auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    h2, h3 {
      color: #2c3e50;
    }

    button {
      display: block;
      width: 100%;
      background-color: #4a90e2;
      color: white;
      font-size: 16px;
      font-weight: bold;
      border-radius: 10px;
      border: none;
      padding: 12px;
      margin-top: 10px;
      cursor: pointer;
    }

    button:hover {
      background-color: #357ab8;
    }

    .section {
      margin-top: 30px;
      text-align: left;
    }

    .question {
      margin: 6px 0;
    }

    .custom-question-inputs {
      margin-top: 10px;
    }

    .add-btn {
      margin-top: 10px;
      background-color: #27ae60;
    }
  </style>
</head>

<body>
<div class="container">
  <h2>Build Your Custom Shop Template</h2>

  <p>
    Use this form to create a shop template. Required sections are preselected.
    You may also add custom questions in each section.
  </p>

  <form id="shopForm">

    <div style="margin-bottom: 20px;">
      <label style="font-weight: bold; background-color: #27ae60; color: white; padding: 12px 20px; border-radius: 8px; cursor: pointer;">
        <input id="recommendedToggle" type="checkbox" style="margin-right: 10px; transform: scale(1.4);"/>
        Use Recommended Template
      </label>
    </div>

    <!-- Example Section -->
    <div class="section">
      <h3>Agent & Visit Information</h3>
      <div class="question"><input checked disabled type="checkbox"><label>Agent Phoned</label></div>
      <div class="question"><input checked disabled type="checkbox"><label>Date of Call</label></div>
      <button type="button" class="add-btn" onclick="addCustomQuestion('custom_agent')">+ Add Custom Question</button>
      <div id="custom_agent" class="custom-question-inputs"></div>
    </div>

    <!-- You already have MANY more sections below â€“ they remain unchanged -->

    <button type="submit">Save Template</button>
  </form>
</div>

<script>
let isRecommendedTemplate = false;

document.getElementById("recommendedToggle").addEventListener("change", function () {
  isRecommendedTemplate = this.checked;
  if (this.checked) {
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = true);
  }
});

document.getElementById('shopForm').addEventListener('submit', async function (e) {
  e.preventDefault();

  const sections = document.querySelectorAll('.section');
  const template = {};

  sections.forEach(section => {
    const title = section.querySelector('h3')?.textContent || '';
    const questions = [];

    section.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
      if (cb.nextElementSibling) {
        questions.push(cb.nextElementSibling.textContent.trim());
      }
    });

    section.querySelectorAll('input[name="custom"]').forEach(input => {
      if (input.value.trim()) {
        questions.push(input.value.trim());
      }
    });

    if (questions.length > 0) {
      template[title] = questions;
    }
  });

  try {
    const res = await fetch('/save-template', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ template, recommended: isRecommendedTemplate })
    });

    const result = await res.json();
    if (res.status === 201) {
      alert(result.message);
      window.location.href = "/dashboard";
    } else {
      alert(result.error || "Unexpected error occurred.");
    }
  } catch (err) {
    alert("Template failed due to server error.");
  }
});
</script>
</body>
</html>
